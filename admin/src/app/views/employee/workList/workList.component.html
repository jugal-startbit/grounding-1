<mat-progress-spinner *ngIf="showSpinner"
                      [diameter]="30"
                      class="list-spinner"
                      color="primary"
                      mode='indeterminate'
                      value="5">
</mat-progress-spinner>
<div class="btn-group float-left">
  <button
    class="btn btn-primary"
    (click)="onChangeDay('All')"
    [class.active]="viewActive == 'All'"
  >
    All
  </button>
  <button
    class="btn btn-primary"
    (click)="onChangeDay('MTD')"
    [class.active]="viewActive == 'MTD'"
  >
    MTD
  </button>
  <button
    class="btn btn-primary"
    (click)="onChangeDay('YTD')"
    [class.active]="viewActive == 'YTD'"
  >
    YTD
  </button>
</div>
<mat-form-field class="col-md-3">
  <mat-select placeholder="Work Status" [formControl]="WorkStatus" multiple>
    <mat-select-trigger>
      {{WorkStatus.value.length > 0 ? getStatusName(WorkStatus.value[0]) : ''}}
      <span *ngIf="WorkStatus.value?.length > 1" class="example-additional-selection">
        (+{{WorkStatus.value.length - 1}} {{WorkStatus.value?.length === 2 ? 'other' : 'others'}})
      </span>
    </mat-select-trigger>
    <mat-option *ngFor="let item of allStatus" [value]="item.StatusID">{{item.Name}}</mat-option>
  </mat-select>
</mat-form-field>
<mat-form-field class="col-md-3">
  <mat-select placeholder="Employee" [formControl]="selectedEmployee">
    <mat-option value="0">All</mat-option>
    <mat-option *ngFor="let item of allEmployees" [value]="item._id">
      {{item.Name}}
    </mat-option>
  </mat-select>
</mat-form-field>
<mat-form-field class="col-md-3">
  <mat-select placeholder="Client" [formControl]="selectedClient">
    <mat-option value="0">All</mat-option>
    <mat-option *ngFor="let item of allClients" [value]="item._id">
      {{item.Name}}
    </mat-option>
  </mat-select>
</mat-form-field>
<button mat-raised-button class="pull-right mr-3" color="warn" (click)="onReset()">Reset</button>
<button mat-raised-button class="pull-right mr-2" color="primary" (click)="getAllWorkByFilter()">Filter</button>
<div class="clearfix mb-2"></div>
<div class="col-md-12 text-right mb-2">
  <button mat-raised-button color="accent" (click)="exportToExcel()">Export to Excel</button>
</div>
<div class="table-entry example-container mat-elevation-z8" id="manager_list">
  <div class="example-loading-shade"
       *ngIf="isLoadingResults || isRateLimitReached">
    <mat-spinner *ngIf="isLoadingResults"></mat-spinner>
    <div class="example-rate-limit-reached" *ngIf="isRateLimitReached">
      API rate limit has been reached. It will be reset in one minute.
    </div>
  </div>
  <div class="example-table-container">
    <table mat-table [dataSource]="dataSource" matSort>

      <!-- ID Column -->
      <ng-container matColumnDef="_id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
        <td mat-cell *matCellDef="let row"> {{row._id}} </td>
        <td mat-footer-cell *matFooterCellDef>  </td>
      </ng-container>

      <!-- TaskName Column -->
      <ng-container matColumnDef="TaskName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Work Name </th>
        <td mat-cell *matCellDef="let row">
          <a class="work-anchor" (click)="onClickWork(row)"> {{row.TaskID.Name}} </a>
        </td>
        <td mat-footer-cell *matFooterCellDef>  </td>
      </ng-container>

      <!-- ClientName Column -->
      <ng-container matColumnDef="ClientName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Client Name </th>
        <td mat-cell *matCellDef="let row"> {{row.ClientID.Name}} </td>
        <td mat-footer-cell *matFooterCellDef>  </td>
      </ng-container>

      <!-- Time Column -->
      <ng-container matColumnDef="Time">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="width75"> Time(days) </th>
        <td mat-cell *matCellDef="let row"> {{row.Time}} </td>
        <td mat-footer-cell *matFooterCellDef>  </td>
      </ng-container>

      <!-- Start Column -->
      <ng-container matColumnDef="Start">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="width100"> Start </th>
        <td mat-cell *matCellDef="let row"> {{row.StartDate | date: 'dd-MM-yyyy'}} </td>
        <td mat-footer-cell *matFooterCellDef>  </td>
      </ng-container>

      <!-- DueDate Column -->
      <ng-container matColumnDef="DueDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="width100"> DueDate </th>
        <td mat-cell *matCellDef="let row"> {{row.Modified | date: 'dd-MM-yyyy'}} </td>
        <td mat-footer-cell *matFooterCellDef>  </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="Status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="width125"> Status </th>
        <td mat-cell *matCellDef="let row"> {{WorkStatusArray[row.StatusID]}} </td>
        <td mat-footer-cell *matFooterCellDef [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> Total </td>
      </ng-container>

      <!-- Cost Column -->
      <ng-container matColumnDef="Cost">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="width100" [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> Total </th>
        <td mat-cell *matCellDef="let row" [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> {{row.Cost | currency: 'INR'}} </td>
        <td mat-footer-cell *matFooterCellDef [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> {{getTotalCost() | currency: 'INR'}} </td>
      </ng-container>

      <!-- PaidAmount Column -->
      <ng-container matColumnDef="PaidAmount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="width100" [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> Paid Amount </th>
        <td mat-cell *matCellDef="let row" [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> {{row.PaidAmount | currency: 'INR'}} </td>
        <td mat-footer-cell *matFooterCellDef [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> {{getTotalPaid() | currency: 'INR'}} </td>
      </ng-container>

      <!-- DueAmount Column -->
      <ng-container matColumnDef="DueAmount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="width100" [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> Due Amount </th>
        <td mat-cell *matCellDef="let row" [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> {{row.DueAmount | currency: 'INR'}} </td>
        <td mat-footer-cell *matFooterCellDef [style.display]="localStorage.role !=='Super Admin' ? 'none': ''"> {{getTotalDue() | currency: 'INR'}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
    </table>
  </div>
  <div *ngIf="dataSource && dataSource.data.length == 0" class="text-center pt-4 pb-4" >No record found.</div>
  <mat-paginator [pageSizeOptions]="[10,20,50]" showFirstLastButtons></mat-paginator>
</div>

<ng4-loading-spinner [threshold]="100" [timeout]="60000" [loadingText]="'Please wait...'" [zIndex]="9999"></ng4-loading-spinner>
